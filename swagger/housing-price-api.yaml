openapi: 3.0.3
info:
  title: Housing Price Analysis API
  description: |
    不動産価格分析ダッシュボード用API

    国土交通省の不動産取引価格情報に基づく実際の取引データを提供します。
    データ形式は国土交通省のオープンデータ仕様に準拠しています。

    主な物件タイプ:
    - 中古マンション等
    - 宅地(土地と建物)
    - 宅地(土地)

    取引データには価格、面積、建築年、構造、都市計画情報等が含まれます。
  version: 1.0.0
  contact:
    name: Housing Price Analysis Team
    email: support@housing-price.com

servers:
  - url: http://localhost:8000/api
    description: Development server
  - url: https://api.housing-price.com
    description: Production server

paths:
  /api/estate/detail:
    post:
      tags:
        - Estate
      summary: 詳細な物件情報を取得
      description: 物件タイプ、構造、間取り、地域などの条件に基づいて詳細な取引情報を取得
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AreaSearchRequest"
            example:
              propertyTypes: ["中古マンション等"]
              structures: ["wood"]
              layouts: ["2K", "2DK"]
              station: "北千住"
              durationInYears: 3
      responses:
        "200":
          description: 検索結果の比較エリア情報
          content:
            application/json:
              example:
                areas:
                  - prefecture: "東京都"
                    city: "港区"
                    districtName: "新橋"
                    tradePrice: "180000000"
                    area: "65"
                    buildingYear: "2002年"
                    structure: "ＲＣ"
                    cityPlanning: "商業地域"
                    coverageRatio: "80"
                    floorAreaRatio: "600"
                    period: "2025年第1四半期"
                    renovation: "未改装"

  /api/estate/average:
    post:
      tags:
        - Estate
      summary: 指定エリアの四半期別平均価格履歴を取得
      description: |
        指定された駅・地区の物件について、指定期間の四半期ごとの平均価格を集計して返します。
        物件タイプ、構造、間取りなどの条件でフィルタリングが可能です。
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PriceHistoryRequest"
            example:
              areaConditions:
                - station: "北千住"
                  propertyTypes: "中古マンション等"
                  structures: ["RC", "SRC"]
                  layouts: ["2K", "2DK", "3LDK"]
                - station: "綾瀬"
                  propertyTypes: "中古マンション等"
                  structures: ["wood", "RC"]
                  layouts: ["1R", "1K", "2K"]
                - station: "亀有"
                  propertyTypes: "宅地(土地と建物)"
                  structures: ["wood"]
                  layouts: ["3LDK", "4LDK_plus"]
              durationInYears: 3

      responses:
        "200":
          description: 四半期別平均価格履歴
          content:
            application/json:
              example:
                duration: 3
                totalQuarters: 12
                chartLabels:
                  - "2022年Q4"
                  - "2023年Q1"
                  - "2023年Q2"
                  - "2023年Q3"
                  - "2023年Q4"
                  - "2024年Q1"
                  - "2024年Q2"
                  - "2024年Q3"
                  - "2024年Q4"
                  - "2025年Q1"
                  - "2025年Q2"
                  - "2025年Q3"
                areas:
                  - areaName: "北千住駅"
                    priceData:
                      [
                        4200,
                        4350,
                        4420,
                        4480,
                        4550,
                        4650,
                        4720,
                        4800,
                        4850,
                        4920,
                        5000,
                        5080,
                      ]
                    unitPriceData:
                      [
                        68.5,
                        70.2,
                        71.1,
                        72.0,
                        73.2,
                        74.8,
                        75.9,
                        77.2,
                        78.0,
                        79.1,
                        80.5,
                        81.7,
                      ]
                  - areaName: "綾瀬駅"
                    priceData:
                      [
                        3800,
                        3920,
                        3980,
                        4050,
                        4120,
                        4200,
                        4280,
                        4350,
                        4420,
                        4500,
                        4580,
                        4650,
                      ]
                    unitPriceData:
                      [
                        61.2,
                        63.1,
                        64.0,
                        65.2,
                        66.4,
                        67.6,
                        68.8,
                        70.0,
                        71.2,
                        72.5,
                        73.8,
                        75.0,
                      ]
                  - areaName: "亀有駅"
                    priceData:
                      [
                        3500,
                        3620,
                        3680,
                        3740,
                        3810,
                        3880,
                        3950,
                        4020,
                        4090,
                        4160,
                        4230,
                        4300,
                      ]
                    unitPriceData:
                      [
                        58.3,
                        60.1,
                        61.2,
                        62.3,
                        63.5,
                        64.7,
                        65.8,
                        67.0,
                        68.2,
                        69.3,
                        70.5,
                        71.7,
                      ]
        "400":
          description: パラメータが不正
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: 指定されたエリアが見つからない
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

components:
  schemas:
    AreaSearchRequest:
      type: object
      required:
        - propertyTypes
        - durationInYears
      properties:
        propertyTypes:
          type: array
          items:
            type: string
            enum: ["中古マンション等", "宅地(土地と建物)", "宅地(土地)"]
          description: 物件タイプ（複数選択可）
        propertyStatuses:
          type: array
          items:
            type: string
            enum: ["new", "used"]
          description: 物件状態（複数選択可）
        structures:
          type: array
          items:
            type: string
            enum: ["wood", "RC", "SRC"]
          description: 構造（複数選択可）
        layouts:
          type: array
          items:
            type: string
            enum: ["1R_1K", "1DK", "2K", "2DK", "3LDK", "4LDK_plus"]
          description: 間取り（複数選択可）
        prefecture:
          type: string
          description: 都道府県コード
        city:
          type: string
          description: 市区町村コード
        station:
          type: string
          description: 最寄り駅・地区コード
        durationInYears:
          type: integer
          enum: [1, 3, 5]
          description: 分析期間（年数）

    PriceHistoryRequest:
      type: object
      required:
        - areaConditions
        - durationInYears
      properties:
        areaConditions:
          type: array
          items:
            $ref: "#/components/schemas/AreaCondition"
          description: 各エリア（駅・地区）ごとの検索条件
        durationInYears:
          type: integer
          enum: [1, 3, 5]
          description: 分析期間（年数）- 全エリア共通

    AreaCondition:
      type: object
      required:
        - station
        - propertyTypes
      properties:
        station:
          type: string
          description: 駅・地区コード
        propertyTypes:
          type: array
          items:
            type: string
            enum: ["中古マンション等", "宅地(土地と建物)", "宅地(土地)"]
          description: 物件タイプ（複数選択可）
        propertyStatuses:
          type: array
          items:
            type: string
            enum: ["new", "used"]
          description: 物件状態（複数選択可）
        structures:
          type: array
          items:
            type: string
            enum: ["wood", "RC", "SRC"]
          description: 構造（複数選択可）
        layouts:
          type: array
          items:
            type: string
            enum: ["1R_1K", "1DK", "2K", "2DK", "3LDK", "4LDK_plus"]
          description: 間取り（複数選択可）

    PriceHistoryResponse:
      type: object
      properties:
        duration:
          type: integer
          description: 取得期間（年数）
        totalQuarters:
          type: integer
          description: 総四半期数
        chartLabels:
          type: array
          items:
            type: string
          description: チャートのラベル配列（四半期形式）
          example: ["2023年Q1", "2023年Q2", "2023年Q3", "2023年Q4"]
        areas:
          type: array
          items:
            $ref: "#/components/schemas/AreaPriceHistory"
          description: 各エリア・駅の価格履歴データ

    AreaPriceHistory:
      type: object
      properties:
        areaName:
          type: string
          description: エリア名（駅名・地区名）
        priceData:
          type: array
          items:
            type: number
          description: 四半期ごとの平均価格データ配列（万円）
        unitPriceData:
          type: array
          items:
            type: number
          description: 四半期ごとの平均単価データ配列（万円/㎡）

    AreaSearchResponse:
      type: object
      properties:
        areas:
          type: array
          items:
            $ref: "#/components/schemas/AreaInfo"

    AreaInfo:
      type: object
      properties:
        id:
          type: string
          description: エリアID
        name:
          type: string
          description: エリア名
        prefecture:
          type: string
          description: 都道府県名
        city:
          type: string
          description: 市区町村名
        station:
          type: string
          description: 最寄り駅名

    MunicipalitiesResponse:
      type: object
      properties:
        municipalities:
          type: array
          items:
            $ref: "#/components/schemas/Municipality"

    Municipality:
      type: object
      properties:
        code:
          type: string
          description: 市区町村コード
        name:
          type: string
          description: 市区町村名

    DistrictsResponse:
      type: object
      properties:
        districts:
          type: array
          items:
            $ref: "#/components/schemas/District"

    District:
      type: object
      properties:
        code:
          type: string
          description: 地区コード
        name:
          type: string
          description: 地区名

    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: エラーメッセージ
        code:
          type: string
          description: エラーコード
        details:
          type: object
          description: エラー詳細情報

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key

security:
  - ApiKeyAuth: []

tags:
  - name: Estate
    description: 不動産情報
